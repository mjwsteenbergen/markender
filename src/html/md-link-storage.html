<template id="md-link-storage">
    
</template>

<script>
    // Refers to the "importer", which is index.html
    var thatDoc = document;
    // Refers to the "importee", which is src/hello-world.html
    var thisDoc =  (thatDoc._currentScript || thatDoc.currentScript).ownerDocument;
    // Gets content from <template>
    var mdLinkStorage = thisDoc.querySelector('#md-link-storage').content;

    class MdLinkStorage extends HTMLElement {
        
        constructor() {
            super();
            this.requesters = []
            this.links = {}
            console.log("initialised");            
        }

        connectedCallback() {
            var clone = document.importNode(mdLinkStorage, true);
            this.appendChild(clone);
            document.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach((item) => {
                item.setAttribute("id", item.innerHTML.toString().toLowerCase().replace(new RegExp(' ', 'g'), '-'));
            });
        }


        subscribe(name) {
            name.setAttribute("name", "Missing Link")
            this.requesters.push(name);
        }

        componentInitialised() { }

        setLink(id, name, href, linker) {
            this.links[id] = { 
                name: name,
                href: href,
                parent: linker
            };
            this.updateRequesters(id);
        }

        updateRequesters(id) {
            var link = this.links[id];
            this.requesters.forEach(i => {
                if(i.getAttribute("link") === id) {
                    i.setAttribute("href", link.href);
                    i.setAttribute("name", link.name);
                    if(link.parent) {
                        link.parent.setAttribute("used",true);
                    }
                }
            });
        }
        

    }
    window.customElements.define('md-link-storage', MdLinkStorage);
</script>